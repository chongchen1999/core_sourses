# 程序性能优化基础

## 编译器优化的局限性

编译器优化虽然强大，但存在几个关键局限性：

1. 内存别名使用：当两个指针可能指向同一内存位置时，编译器必须假设最坏情况，无法进行某些优化
2. 函数副作用：编译器无法确定函数调用是否会产生副作用（如修改全局变量），因此必须保留所有函数调用
3. 保守假设：编译器必须生成对所有可能输入都正确的代码，无法针对特定输入模式进行优化
4. 浮点运算限制：由于浮点运算的非结合性，编译器通常不能重新排列浮点运算顺序
5. 调试信息保留：在调试模式下，编译器通常会禁用大多数优化以保留源代码结构

## 表示程序性能的方法

**基本性能指标**

1. 响应时间：程序完成特定任务所需的总时间
2. 吞吐量：单位时间内完成的操作数量
3. 资源利用率：CPU、内存、I/O等资源的使用效率

**CPE(Cycles Per Element)**

CPE是衡量处理每个数据元素所需CPU周期数的指标，特别适用于评估循环密集型操作的性能。

CPE的计算方法：
```
CPE = (总CPU周期数) / (处理的元素数量)
```

CPE的意义：
1. 提供处理器效率的标准化度量
2. 允许比较不同算法或实现的性能
3. 帮助识别性能瓶颈
4. 与理论处理器极限进行比较

降低CPE的策略：
1. 循环展开：减少循环控制开销
2. 并行计算：利用处理器的超标量特性
3. 数据预取：减少缓存未命中
4. 指令调度：减少流水线停顿
5. SIMD指令：使用向量化指令处理多个数据

示例分析：
假设一个处理1000个元素的循环消耗了5000个CPU周期：
```
CPE = 5000 cycles / 1000 elements = 5.0 cycles/element
```

理想情况下，CPE可以接近甚至低于1.0，这取决于操作复杂度和处理器能力。